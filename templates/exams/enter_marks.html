{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">üìù Enter Marks</h2>
    </div>

    <div class="card shadow-sm bg-light mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-3">
                    <label>Select Exam</label>
                    <select name="exam" class="form-select" required>
                        <option value="">-- Choose Exam --</option>
                        {% for ex in exams %}
                            <option value="{{ ex.id }}" {% if ex.id == sel_exam %}selected{% endif %}>
                                {{ ex.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Class</label>
                    <select name="class_grade" class="form-select" required>
                        <option value="">-- Choose Class --</option>
                        {% for cls in classes %}
                            <option value="{{ cls.id }}" {% if cls.id == sel_class %}selected{% endif %}>
                                {{ cls.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label>Subject</label>
                    <select name="subject" class="form-select" required>
                        <option value="">-- Choose Subject --</option>
                        {% for sub in subjects %}
                            <option value="{{ sub.id }}" {% if sub.id == sel_subject %}selected{% endif %}>
                                {{ sub.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Load Students</button>
                </div>
            </form>
        </div>
    </div>

    {% if students_data %}
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="exam_id" value="{{ sel_exam }}">
        <input type="hidden" name="subject_id" value="{{ sel_subject }}">

        <div class="card shadow">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">üìã Student List for Grading</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th width="10%">Roll No</th>
                                <th width="40%">Student Name</th>
                                <th width="20%">Father Name</th>
                                <th width="30%">Marks Obtained (Out of 100)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in students_data %}
                            <tr>
                                <td class="text-center">{{ item.student.roll_number|default:"-" }}</td>
                                <td>
                                    <strong>{{ item.student.first_name }} {{ item.student.last_name }}</strong>
                                </td>
                                <td>{{ item.student.father_name }}</td>
                                <td>
                                    <input type="number" step="0.01" name="marks_{{ item.student.id }}" 
                                           class="form-control text-center fw-bold text-primary" 
                                           value="{{ item.marks }}" placeholder="0.00" min="0" max="100">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer text-end">
                <button type="submit" class="btn btn-success btn-lg px-5">üíæ Save Results</button>
            </div>
        </div>
    </form>
    {% elif sel_exam %}
        <div class="alert alert-info text-center">No students found for the selected criteria.</div>
    {% endif %}
</div>
{% endblock %}